using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Identity;
using Microsoft.AspNetCore.Mvc;
using Microsoft.Extensions.Logging;
using Microsoft.Extensions.Options;
using Moq;
using Weather_forecast.Controllers;
using Weather_forecast.Data;
using Weather_forecast.Models;
using Weather_forecast.Services;
using Weather_forecast.ViewModels;

namespace Weather_forecast.Testing.Tormi_testid
{
    public class WeatherTests : TestBase
    {
        [Fact]
        public async void Should_ReturnTallinn_WhenGettingLocationByIP()
        {
            var result = await Svc<LocationByIPService>().LocationByIP();

            Assert.Equal("Tallinn", result);
        }

        [Fact]
        public void Should_ReturnQRCodeString_WhenGettingQRByURL()
        {
            var result = Svc<QrCodeService>().CreateSharedForecastQRCodeAsB64("https://localhost:5001/Home/Shared?city=Tallinn&shareToken=d2754d3a-ee52-411b-9253-68d451dbf52e&uid=54f30ca8-71c8-4f9f-888e-7d0fbd761055&metric=True&foreCastDate=21.11.2025 10:15:55");

            Assert.Equal("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", result);
        }

        [Fact]
        public void Should_ReturnQRCodeString_WhenGettingQRByShareDto()
        {
            ShareDto shareDto = new ShareDto()
            {
                City = "Tallinn",
                ShareToken = Guid.Parse("d2754d3a-ee52-411b-9253-68d451dbf52e"),
                UID = Guid.Parse("54f30ca8-71c8-4f9f-888e-7d0fbd761055"),
                Date = DateTime.Parse("21.11.2025 10:15:55"),
                Metric = true
            };

            var result = Svc<QrCodeService>().CreateSharedForecastQRCodeAsB64(shareDto);

            Assert.Equal("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", result);
        }
    }
}